!function () {
		var width, height, largeHeader, canvas, ctx, circles, target, animateHeader = true;

		// Main
		initHeader();
		addListeners();

		function initHeader() {
			this.$window = $(window);
			
			var container  = document.createElement("div");
			container.style.width = "100%";
			container.style.height = "100%";
			container.style.margin = "0";
			container.style.padding = "0";
			container.style.position = "fixed";
			container.style.top = "0px";
			container.style.left = "0px";
			container.style.zIndex = "-1";
			container.style.background = "linear-gradient(200deg,#a0cfe4,#e8c37e);";
			document.body.appendChild(container);
			debugger;
			this.$container = $(container);
			
			this.width = this.$container.width();
			this.height = this.$container.height();
			this.center = {x : this.width / 2, y : this.height / 2};
			this.countRate =  this.width * this.height / 500 / 500;
			this.canvas = $('<canvas />').attr({width : this.width, height : this.height,}).appendTo(this.$container).get(0);
			
			ctx = this.canvas.getContext('2d');

			// create particles
			circles = [];
			for(var x = 0; x < width*0.5; x++) {
				var c = new Circle();
				circles.push(c);
			}
			animate();
		}

		// Event handling
		function addListeners() {
			window.addEventListener('scroll', scrollCheck);
			window.addEventListener('resize', resize);
		}

		function scrollCheck() {
			if(document.body.scrollTop > height) animateHeader = false;
			else animateHeader = true;
		}

		function resize() {
			width = window.innerWidth;
			height = window.innerHeight;
			largeHeader.style.height = height+'px';
			canvas.width = width;
			canvas.height = height;
		}

		function animate() {
			if(animateHeader) {
				ctx.clearRect(0,0,width,height);
				for(var i in circles) {
					circles[i].draw();
				}
			}
			requestAnimationFrame(animate);
		}

		// Canvas manipulation
		Circle.prototype = {
			//var _this = this;

			// constructor
			//(function() {
			//	_this.pos = {};
			//	init();
				//console.log(_this);
			//})();

			init:function() {
				this.pos.x = Math.random()*width;
				this.pos.y = height+Math.random()*100;
				this.alpha = 0.1+Math.random()*0.3;
				this.scale = 0.1+Math.random()*0.3;
				this.velocity = Math.random();
				this.draw();
			}

			draw : function() {
				if(this.alpha <= 0) {
					init();
				}
				this.pos.y -= this.velocity;
				this.alpha -= 0.0005;
				ctx.beginPath();
				ctx.arc(this.pos.x, this.pos.y, this.scale*10, 0, 2 * Math.PI, false);
				ctx.fillStyle = 'rgba(255,255,255,'+ this.alpha+')';
				ctx.fill();
			};
		}

}();
